# add new tdyn calculation

# update main and re-run

# update tdyn calculation to min(r_50 sf, current radius)

# box and whisker plot for relaxation types ETG vs LTG. x:type, yaxis:relaxation time

# try out ETG to ETG, LTG to LTG, etc. based on start vs final kappa. relaxation_morphology = ['LTG-LTG', 'ETG-ETG', 'LTG-ETG', 'ETG-LTG'],               # ['LTG-LTG', 'ETG-ETG', 'LTG-ETG', 'ETG-LTG']

# make spearman_plot scatter

# practice presentation

# try 1 hmr... see what happens
# trim for uncertainty... say 20 degrees? see what happens




# presentation
# pay rent on 29th

# add writing notes to project 1 plan

# Play with parameters:
    The ones that take the longest... is it due to multiple mergers?
	trelax/tdyn... maybe we get a peak with a tail
	trelax/tdyn vs ellipticity... should be inverse relationship
	Mass vs relaxation time, controlled for offset
	Inflow vs relaxation time, controlled for offset
		ignore first 200 mya of long tones? Or over some threshold? could do specific... might need control. ei. 20% of mass was accreted within X Mya
	Environment vs relaxation time, controlled for offset
	Morphology vs relaxation time, controlled for offset
	Gas ratio of mergers vs offset or relaxation time, controllef for 
	Check for effect of centrals vs satellites

# run snips 134-165 on serpens on SUNDAY
# re-run locally with 10**9.5 as min for misalignments
# Run 9.5-10 samples
# Merge outputs, merge samples on serpens

# Add kappa_nsf, ap_sfr to misalignment_tree ctrl+f 'WHEN RUN FINISHES'
# Add kappa_nsf, ap_sfr to snip_evolution 
# Add ellip, triax, etc... to misalignment_tree
	# remove excess lbol calculations in snip analysis and evolution


_____________________________________________________________
|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
DONE WEEK 50:
- Messaged Tim about paris
- RE-RUN with ellip, triax, abs
- Tested merge csv
- Spoke with Tim
- Remade plots for co-co, etc.
- Added SF radius, new tdyn calculations and the likes

WRITING:
- We do not consider satellite galaxies in our analysis because they are more sensitive to external sources of turbulence, such as ram-pressure stripping and strong tidal interactions (e.g. Gunn & Gott 1972; Boselli & Gavazzi 2006; Bahé & McCarthy 2015; Wright et al. 2022)
- all w.r.t stellar COM 
- Assume gas disk descibed by r_50 for sf. tdyn is calculated with min(r_50_sf, and [current radius]), capped at 1 kpc for resolution. Masses chosen to match
	- Faster relaxation times are broadly ETGs due to smaller SF r_50, LTGs have slower relaxation times due to large radii or capping... but t_torque is an upper limit anyway
- Mention how larger R SF for LTG makes up for larger ellipticity


Tim:
- Agree that misalignments for which mergers are clearly the cause appear only 20%, so its gas accretion
	- Contends with casanueva as AGN feedback may have made it easier for gas to become misaligned in the first place ?
- Dont have the resolution for many Radii, try SF radius
- Agree there is no separate group
- Look into ETG vs LTG relaxation types
- Agree that selection effects on delta play a role, he noticed the gap
- kappa and spin parameter basically the same
- Can get working on BH/AGN during writing phase


|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
-------------------------------------------------------------

# NOTES ON SAMMI GALAXY SURVEY PAPER:
- observational paper using SAMI IFS to investigating alignment of galaxies (and components of stars and gas) w.r.t closest filament
- thought that galaxies during formation and while they are low mass naturally have spins parallel to filament
- mergers along filaments, interactions can disrupt that, and make it so these galaxies have perpendicular alignments 
- But as they continue to passively accrete, they are expected to realign to parallel
- Some suggest AGN feedback plays a role by preventing gas inflow and avoiding realignment, such as via randomising direction of cold gas accretion early on
- star formation not found to have big impact

- paper basically looks at : does BH activity matter, if so is it instantaneous or integrated activity (using central velocity dispersion as proxy)
							 differences in stellar alignment and ionized gas alignment
- Sample of about 1000 galaxies with masses 9-12
- use C_AGN as proxy for instantaneous bh activity as departure in log scale from SF limit. high C = AGN. Spearman of -0.09, p of 0.005 showig significant correlation

FIG 4 TOP | as AGN activity incerases, we see more misalignment for stars -> parallel to perpendicular. Second fig shows PDF skewed towards more parallel spin-filament for low activity, and vice versa
- however, Cagn also correlates strongly with bulge... and we know of a bulge dependancy of spin-filamenet alignments (tracer for mergers)
- they then apply a partial least squares regression and find 86% of the variance in stellar spin explained through bulges, only 0.6% through AGN activity...

ergo, spin-flip correlaction with AGN is due to AGN-bulge relation. Similar results for gas, but we only have ~70% explained by mergers, with AGN going to 10%. 
-> points toward instantaneous AGN activity affecting gas alignmenet much more strongly than stars 

FIG 8 | same angle correlation also found for cumulative BH mass, but with bulge mass dominating correlation as opposed to BH mass

FIG 11 | relative importance of each galaxy parameter for spin filament alignment

FIG 13 RIGHT | bulge-BH mass, and alignment

-> concludes: AGN feedback drives galaxy qucnhing while mergers trigger spin fliament alignment flips and bulge growth
-------------------------------------------------------------


⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⠀⠈⠉⠉⠛⠛⠷⢶⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣴⣶⣶⣿⣿⣿⣿⣷⣶⣦⣤⣄⡀⠈⠙⠻⣷⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣾⣿⣿⠿⠿⠛⠛⠛⠛⠻⠿⠿⣿⣿⣿⣿⣿⣷⣤⡀⠀⠙⢿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⣴⣾⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠻⣿⣿⣿⣿⣷⡄⠀⠙⢿⣷⡀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⢀⣴⡿⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⢿⣿⣿⣿⣦⠀⠈⢿⣿⡄⠀⠀⠀⠀⠀
⠀⠀⣠⡾⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠒⠒⠒⠤⣄⣀⠀⠀⠀⠻⣿⣿⣿⣷⡀⠀⢿⣿⡀⠀⠀⠀⠀
⠀⣰⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣴⣶⣶⣶⣶⣶⣦⣤⡀⠉⠳⣦⡀⠀⠘⣿⣿⣿⣧⠀⠈⣿⣇⠀⠀⠀⠀
⢰⠏⠀⠀⠀⠀⠀⠀⢀⠔⠀⣠⣴⣿⣿⡿⠛⠋⠉⠉⠉⠉⠙⠻⣿⣷⡀⠈⢷⡀⠀⠸⣿⣿⣿⡄⠀⢹⣿⠀⠀⠀⠀
⠏⠀⠀⠀⠀⠀⢀⡴⠃⢀⣼⣿⣿⠟⠁⠀⠀⡀⠀⢀⣠⣤⡤⣤⡈⢻⣿⡀⠘⣇⠀⠀⣿⣿⣿⡇⠀⢸⣿⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢠⡞⠀⢠⣿⣿⡿⠁⠀⢀⡴⠊⣠⡾⠋⠉⠀⠀⠀⡟⢈⣿⡇⢠⡟⠀⠀⣿⣿⣿⠃⠀⣸⡏⠀⠀⠀⠀
⠀⠀⠀⠀⢠⡟⠀⢀⣿⣿⡿⠀⠀⢠⡏⢠⣾⠏⢀⡠⢲⡖⢀⡜⠁⣼⡿⠀⣼⠃⠀⢰⣿⣿⡿⠀⢀⡿⠁⠀⠀⠀⠀
⠀⠀⠀⠀⣿⠃⠀⣼⣿⣿⡇⠀⢠⡿⠀⣾⡏⢀⡎⠀⠈⠉⠁⢀⣼⠟⢁⡼⠁⠀⢀⣾⣿⡿⠁⠀⡾⠁⠀⠀⠀⠀⠀
⠀⠀⠀⢸⣿⠀⠀⣿⣿⣿⡇⠀⢸⡇⠀⣿⣧⠸⣧⣤⣤⣴⠾⠛⠁⠐⠁⠀⠀⣠⣾⣿⡟⠁⢀⡞⠁⠀⠀⠀⠀⠀⡄
⠀⠀⠀⢸⣿⠀⠀⣿⣿⣿⡇⠀⠈⣷⡀⠹⣿⣦⣀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣾⣿⡿⠋⢀⡴⠋⠀⠀⠀⠀⠀⠀⣰⠃
⠀⠀⠀⢸⣿⡄⠀⢹⣿⣿⣿⡀⠀⠘⢷⡄⠈⠻⢿⣿⣶⣶⣶⣶⣾⣿⣿⡿⠟⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠃⠀
⠀⠀⠀⠈⣿⣧⠀⠈⢿⣿⣿⣷⡄⠀⠀⠙⠳⠤⣀⣈⠉⠉⠙⠋⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⠃⠀⠀
⠀⠀⠀⠀⠘⣿⣧⠀⠈⢿⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠈⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⡟⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠙⣿⣧⡀⠀⠻⣿⣿⣿⣿⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣾⡿⠋⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⠻⣿⣆⠀⠈⠻⢿⣿⣿⣿⣿⣶⣤⣄⣀⡀⠀⠀⠀⠀⢀⣀⣀⣤⣶⣾⡿⠟⠉⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣷⣦⣀⠀⠉⠻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠷⣦⣤⣀⠀⠈⠉⠉⠙⠛⠛⠛⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠛⠛⠒⠒⠒⠒⠒⠒⠒⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀


===========================================================
NOTABLE GALAXIES:
1361598 	- Counter -> Co slow relax
1403994		- Counter -> Co quick relax
10421872	- Perfect little misalignment from a merger
17879310	- Couple of peaks
21200847	- Perfect spike misalignment with mergers
21659372	- Completely counter-rotating
24053428	- Counter -> Co steady relax
182125501	- Relaxation included
274449295	- LTG with small misalignment
105202325	- good misalignment without merger
21532243	- good misalignment with merger (example)


1e10-1e15				 tot  co-co co-count count-co count-count
Number of misalignments: 209  	143   	28		27		11		30 abs pre: 0.5, post: 0.5, time: 0.1				
						 957   	524		205		109		119		30 abs, no mergers, time: 0.1
						    									30 proj, inc 10, pre: 0.5, post: 0.5, time: 0.1
						     									30 proj, inc 10, no mergers, time: 0.1

We don't use projected angles and all in abs halfmass rad

===========================================================
GUIDE TO galaxy_tree['%s' %GalaxyID] VALUES:

Galaxies that merge do not show final merger ratio and simply end array.
Galaxies where stellermass cant be defined have merger_ratio = math.nan
Snaps will be recorded from first to last, with nan inbetween
     
galaxy_tree['%s' %ID_dict]

GalaxyID                -
DescendantID            -
GroupNum                -
SubGroupNum             -
SnapNum                 -
Redshift                -
Lookbacktime            -
halomass                - total per subfind
#ap_sfr					- [Msun/yr] in aperture
rad                     - [pkpc]
radproj                 - [pkpc]
ellip					- For spherical, e=0. Typically 0.2-0.3 for ETG, 0.6-0.8 for LTG
triax					- low and high values of T correspond to oblate and prolate ellipsoids, respectively
disp_ani				- Values of δ > 0 indicate that the velocity dispersion is primarily contributed by disordered motion in the disc plane
disc_to_total			- The mass fraction of stars that are rotationally-supported (which can be considered the ‘disc’ mass fraction) is a simple and intuitive kinematic diagnostic.
rot_to_disp_ratio		- the ratio of rotation and dispersion velocities
merger_ID               - merger stuff
merger_ratio_stars      - peak stellar ratios in past 2 Gyr ish
merger_ratio_gas        - gas ratios at time of peak stellar ratios
gasdata_old             - gets updated and replaced with math.nan

#'other'
#    '1.0_hmr'
#    '2.0_hmr'
#        tot_mass        - [Msun] total mass of all masses
#        vcirc           - [km/s] circular velocity according to virial theorem
#        tdyn            - [Gyr] relaxation time at this radius
		
'stars'
    tot_mass            - total subfind mass
    ap_mass             - total aperture mass
    kappa               - kappa
    '1.0_hmr'
    '2.0_hmr'
        mass            - mass in radius
        count           - counts in radius
        Z               - metallicity in radius
        proj_angle      - angle to viewing axis

'gas'
    tot_mass            - total subfind mass
    ap_mass             - total aperture mass
    kappa               - kappa
    '1.0_hmr'
    '2.0_hmr'
        mass            - mass in radius
        count           - counts in radius
        sfr             - sfr in radius [Msun/yr]
        Z               - metallicity in radius
        proj_angle      - angle to viewing axis
        inflow_rate     - inflow rate at radius [Msun/yr]
        inflow_Z        - inflow metallicity (mass-weighted, but Z is fine)
        outflow_rate    - outflow rate at radius [Msun/yr]
        outflow_Z       - outflow metallicity (mass-weighted, but Z is fine)
        stelmassloss_rate   - stellar mass loss rate [Msun/yr]
        insitu_Z        - metallicity of material that remained (mass-weighted, but Z is fine)

'gas_sf'
    ap_mass             - total aperture mass
    kappa               - kappa
    '1.0_hmr'
    '2.0_hmr'
        mass            - mass in radius
        count           - counts in radius
        sfr             - sfr in radius [Msun/yr]
        Z               - metallicity in radius
        proj_angle      - angle to viewing axis
        inflow_rate     - inflow rate at radius [Msun/yr]
        inflow_Z        - inflow metallicity (mass-weighted, but Z is fine)
        outflow_rate    - outflow rate at radius [Msun/yr]
        outflow_Z       - outflow metallicity (mass-weighted, but Z is fine)
        stelmassloss_rate   - stellar mass loss rate [Msun/yr]
        insitu_Z        - metallicity of material that remained (mass-weighted, but Z is fine)

'gas_nsf'
    ap_mass             - total aperture mass
    #kappa               - kappa
    '1.0_hmr'
    '2.0_hmr'
        mass            - mass in radius
        count           - counts in radius
        Z               - metallicity in radius
        proj_angle      - angle to viewing axis
        inflow_rate     - inflow rate at radius [Msun/yr]
        inflow_Z        - inflow metallicity (mass-weighted, but Z is fine)
        outflow_rate    - outflow rate at radius [Msun/yr]
        outflow_Z       - outflow metallicity (mass-weighted, but Z is fine)
        stelmassloss_rate   - stellar mass loss rate [Msun/yr]
        insitu_Z        - metallicity of material that remained (mass-weighted, but Z is fine)

'dm'
    ap_mass             - total aperture mass
    count               - total count in aperture
    proj_angle          - angle to viewing axis

'bh'
    mass                - bh mass of central BH (not particle mass)
    mdot_instant        - [ Msun/yr ] mdot of that particle
    mdot                - [ Msun/yr ] mdot averaged over snipshot time difference
    edd                 - instantaneous eddington from mdot_instant
	lbol				- instantaneous bolometric luminosity [erg/s]
    count               - len(mass)

'stars_gas'
    '1.0_hmr'           value may not exist if pkpc was capped at maximum. If 0 particles appends math.nan, will have values for everything else (even min particle not met)
    '2.0_hmr'
        angle_abs       - angle
        err_abs         - error 
        angle_proj      - projected angle
        err_proj        - error of projected
        com_abs         - com [pkpc]
        com_proj        - com [pkpc] for viewing axis

'stars_gas_sf'
    '1.0_hmr'           value may not exist if pkpc was capped at maximum. If 0 particles appends math.nan, will have values for everything else (even min particle not met)
    '2.0_hmr'
        angle_abs       - angle
        err_abs         - error 
        angle_proj      - projected angle
        err_proj        - error of projected
        com_abs         - com [pkpc]
        com_proj        - com [pkpc] for  viewing axis

'stars_gas_nsf'
    '1.0_hmr'           value may not exist if pkpc was capped at maximum. If 0 particles appends math.nan, will have values for everything else (even min particle not met)
    '2.0_hmr'
        angle_abs       - angle
        err_abs         - error 
        angle_proj      - projected angle
        err_proj        - error of projected
        com_abs         - com [pkpc]
        com_proj        - com [pkpc] for  viewing axis

'gas_sf_gas_nsf'
    '1.0_hmr'           value may not exist if pkpc was capped at maximum. If 0 particles appends math.nan, will have values for everything else (even min particle not met)
    '2.0_hmr'
        angle_abs       - angle
        err_abs         - error 
        angle_proj      - projected angle
        err_proj        - error of projected
        com_abs         - com [pkpc]
        com_proj        - com [pkpc] for  viewing axis

'stars_dm'
    '1.0_hmr'           value may not exist if pkpc was capped at maximum. If 0 particles appends math.nan, will have values for everything else (even min particle not met)
    '2.0_hmr'
        angle_abs       - angle
        err_abs         - error 
        angle_proj      - projected angle
        err_proj        - error of projected
        com_abs         - com [pkpc]
        com_proj        - com [pkpc] for  viewing axis
		
============================================================
GUIDE TO misalignment_tree['%s' %GalaxyID] VALUES:

GalaxyID is first ID in window of misalignment.
Arrays contain no missing entries

Mergers searched for from first misaligned, to first relax

'GalaxyID'				-
'SnapNum'				-
'Redshift'				-
'Lookbacktime'			- [ Gyr ]

'SubGroupNum'			- 
'halomass'				- [ Msun ]
'stelmass'				- [ Msun ]
'gasmass'				- [ Msun ]
'sfmass'				- [ Msun ]
'nsfmass'				- [ Msun ]				
'dmmass'				- [ Msun ]

'sf'					- [ Msun/yr]
'ssfr'					- [ /yr ]

'stars_Z'				-
'gas_Z'					-
'sf_Z'					-	
'nsf_Z'					-

'kappa_stars'			-
'kappa_gas'				-
'kappa_sf'				-
#'kappa_nsf'			-

'rad'					- [ pkpc ]
'radproj'				- [ pkpc ]

'inflow_rate'			- [ Msun/yr ]
'inflow_Z'				-
'outflow_rate'			- [ Msun/yr ]
'outflow_Z'				-
'stelmassloss_rate'		- [ Msun/yr ]
'insitu_Z'				-

'bh_mass'				- [ Msun ]
'bh_mdot_av'			- [ Msun/yr ]
'bh_mdot_inst'			- [ Msun/yr ]
'bh_edd'				-
'bh_lbol'				- [ erg/s ]

'stars_gas_sf'			- all in degrees
'stars_gas_sf_err'		-
'stars_dm'				- not checked for inclination
'stars_dm_err'			-

'merger_ratio_stars'	- Includes ALL mergers in window
'merger_ratio_gas'		- ^

'index_m'				- Last before misaligned, adjusted for current window
'index_r'				- First to be relaxed
'index_merger' 			- Index of mergers that met locations. Use this to sample 'merger_ratio_stars'
'relaxation_time' 		- [ Gyr ] Time between index_m and index_r
'relaxation_type'		- co-co, counter-counter, co-counter, counter-co
'angle_peak'			- peak misalignment angle from where it relaxes to (-co, -counter)
'index_peak'			- index of the above w.r.t array

============================================================
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣤⡴⠶⠞⠛⠛⠉⠉⠉⠉⠉⠉⠛⠛⠶⢦⣄⡀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣤⣶⣾⠿⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀⠈⠛⢦⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠶⢛⣩⠶⠛⠉⠀⠀⠀⣀⣤⡴⠶⠚⠛⠛⠛⠉⠛⠛⠛⢶⡟⠉⢻⡄⠀⠀⠀⠈⢻⡄
⠀⠀⠀⠀⠀⠀⠀⣠⡴⠟⢉⣠⠶⠋⠁⠀⠀⣠⡴⠞⠋⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠷⡤⠾⣇⠀⠀⠀⠀⠀⣿
⠀⠀⠀⠀⣠⡴⠛⠁⣀⡴⠛⠁⠀⢀⣠⠶⠛⠁⠀⠀⠀⣀⣠⡤⠶⠒⠛⠛⠛⠛⠛⠶⣤⡀⠀⠀⠀⢹⡆⠀⠀⠀⠀⢸
⠀⢀⣴⠟⠁⠀⣠⡾⠋⠀⠀⢀⡴⠛⠁⠀⢰⠞⠳⡶⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣷⠀⠀⠀⢈⡇⠀⠀⠀⠀⣾
⢴⠟⠁⠀⢀⡼⠋⠀⠀⢀⡴⠋⠀⠀⠀⣠⡾⠷⠶⠇⢀⣠⣤⠶⠖⠲⢶⣄⠀⠀⠀⠀⠀⡿⠀⠀⠀⢸⡇⠀⠀⠀⢰⡏
⠀⠀⠀⣰⠟⠀⠀⠀⣴⠏⠀⠀⠀⣠⠞⠉⠀⠀⣠⡶⠋⠁⠀⠀⠀⠀⢀⡿⠀⠀⠀⠀⣼⠃⠀⠀⢀⡟⠂⠀⠀⢠⡟⠀
⠀⢀⣼⠋⠀⠀⢀⡾⠁⠀⠀⢠⡞⠁⠀⠀⢠⡾⠁⠀⠀⠀⠀⣀⣀⣠⡾⠁⠀⠀⣠⡾⠁⠀⠀⢠⡞⠁⠀⠀⣰⠟⠀⠀
⠀⣾⠃⠀⢠⡟⠛⣷⠂⠀⢠⡟⠀⠀⠀⠀⢾⡀⠀⠀⠀⠀⣸⣏⣹⡏⠀⠀⣠⡾⠋⠀⠀⢀⣴⠏⠀⠀⢀⡼⠋⠀⠀⠀
⣸⠇⠀⠀⠈⢻⡶⠛⠀⠀⣿⠀⠀⠀⠀⠀⠈⠛⠲⠖⠚⠋⠉⠉⠉⣀⣤⠞⠋⠀⠀⢀⣴⠟⠁⠀⠀⣰⠟⠁⠀⣴⠆⠀
⣿⠀⠀⠀⠀⢸⡇⠀⠀⠀⢻⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠶⠛⠉⣀⣀⡀⣀⡴⠟⠁⠀⢀⣤⠞⠁⢀⣴⠟⠁⠀⠀
⣿⠀⠀⠀⠀⠘⣧⠀⠀⠀⠀⠙⠳⠶⠤⣤⠤⠶⠶⠚⠋⠉⠀⠀⠀⡟⠉⠈⢻⡏⠀⠀⣀⡴⠛⠁⣠⡶⠋⠁⠀⠀⠀⠀
⢻⡀⠀⠀⠀⠀⠘⢷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⠶⠻⢦⣤⠟⣀⣤⠞⢋⣠⡴⠛⠁⠀⠀⠀⠀⠀⠀⠀
⠈⢿⣄⠀⠀⠀⠀⠀⠈⠛⠳⠶⠤⠤⠤⠤⠤⠴⠶⠒⠛⠉⠁⠀⠀⢀⣠⡴⣞⣋⣤⠶⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠙⢷⡶⠛⠳⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣴⣾⠿⠿⠛⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠘⣧⡀⣀⣿⠦⣤⣤⣤⣤⣤⣤⠤⠶⠶⠞⠛⠋⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠈⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀


============================================================
PAPER 1 PLAN (17 pages)

Intro: (2 pages)
- Establish galaxy structure
- What is misalignment
	- How are they formed?
- Occurence and distributions, Tim paper 2011
- Relaxation timescale issue and the dilemma it creates

Simulation: (1 page)
- EAGLE and models used (brief)
- Subfind
- Use of snipshots

Methods: (3 pages)
- Aperture size of 30pkpc and all properties calculated within
	- halo mass and merger_tree properties
- General properties:
	- Gas sf (?)
	- Projected radius
	- Angular momentum vector
	- Kappa
- Temporal properties:
	- Define relaxation time
	- Inflow/outflow
		- Mass change
		- Metallicity
	- Mergers
		- Stellar and gas ratios (and why not gas sf ratio) using
		  greatest ratio in past 1 Gyr
- Sample:
	- Mass limit
	- Variable minimum particle counts
	- COM 2pkpc		

Results and Discussion: (7)
- Stars-gas-sf misalignment angles projected at z=0.1 with raimundo results,
  differentiated by kappa
	- Highlight how this is similar to existing observational and 
	  simulation results
	-> Appendix A for stars-gas, stars-dm
	-> Appendix B for distributions z
- Individual galaxy evolution 
	- Highlight typical features
	- Describe relaxation time, and care needed for defining when mergers
	  occur (and ratios) with respect to misalignment
	- How we define misalignment, and how that effects relaxation time
- Timescale stack(s)
	- Based on when misaligned, merger within X years of misalignment
	  Abs angles not proj
	-> Appendix C with 45 degree
	- Highlight difference between kappa, and how most only 'blip', others 
	  last much longer
- Timescale distribution
	- Parametisation:
		- Mass
		- Morphology
		- SFR
		- Merger ratio
		- Delta misalignment angle
		- Occurence of inflow
- Discussion of linking this to merger rate... % of galaxies in each that have
  a merger in recent 0.5 Gyr and a misalignment

Conclusion: (1 page)
- Short of above

Acknowledgements: (0.25 page)
- EAGLE and subfind
- liverpool
- STFC grant

References: (1.5 pages)

Appendix:(1.5 page)
A. stars-gas distribution, stars-dm distribution
	- Highlight how this is similar to existing observational and 
	  simulation results
B. Timescale occurence showing when galaxies misalign the most
C. Timescale stack with 45 degree



============================================================
PAPER 2 PLAN (7 pages)

Intro: (1 page)
- Galaxy structure
- What is misalignment
	- How are they formed?
	- AGN outflows as cause
	- Reference paper 1 for more detailed breakdown
- Links between AGN and misalignments
	- Penny
	- Raimundo
	- Duckworth

Simulation: (0.5 page)
- EAGLE and models used (very brief)
- Subfind
- Use of snipshots

Methods: (1.5 page)
- Aperture size of 30pkpc and all properties calculated within
	- halo mass and merger_tree properties
- Refer to same methods as used in paper 1
- BH properties
	- Use largest subhalo BH within 1 HMR, then 2 HMR, else none
  	- Accretion both instantaneous for eddington, and difference
	  in mass over successive snapshots
	- Classify AGN as luminosity
- Sample:
	- Mass limit
	- Variable minimum particle counts
	- COM 2pkpc	
	- With BH

Results and Discussion: (3.5 pages)
- BH growth change in 1 GYR before misalignment as cause
	- parametise
	- outflow?
- BH growth for duration of misalignment
- Create same graph as raimundo:
	- Misalignments with AGN vs no AGN
		- Different redshifts
		- Instant vs average over past Gyr
	-> Appendix A for 45 degree
- Cause vs enhance

Conclusion: (0.75 page)
- Short of above

Acknowledgements: (0.25 page)
- EAGLE and subfind
- liverpool
- STFC grant

References: (0.5 pages)

Appendix: (1 pages)
A. 45 degree graphs



============================================================
Issue with gn 

# Fix bug for HMR									V									V					
Run		iter	ID				Mass in tree	  Mass in snip 	center in tree		center in snip/snap		gn	 sgn	halo
151		13957 	236710612		1.10e10			  1.68e9		88.88 52.56 5.40	72.40 46.19 34.58		2378 0		5.80629823488E11	
151		19987 > 342074093		1.67e9							72.40 46.19 34.58							2379 0		5.55924324352E11		... this is what gn=2378 points to
151		19989	342077564		1.72e9							72.49 46.21 34.44							2379 1		5.55924324352E11

Contenders:								-ROUGH-	  															-ROUGH-
22		-		11482239		  Y		1.18e10	    N  			  Y		88.88 52.52 5.35	   N			2389 0				centre tree matched, mass matched, particles not matched
22		-		14648187	     ~Y		5.65e10	    N			  N	    72.85 47.35 35.15	  ~Y			554	 0				centre snip matched ish, mass not matched, particles matched 
22		-	  >	10321177		  N		1.71e9	    Y			  N		72.39 46.20 34.61	   Y			2398 0				centre snip matched, mass snip matched

Center associated with a given GN stated in merger tree does not agree with snipshot. 
When looking at the center in tree, turns out a different GN is there	-> wrong/incorrect sample GN
When looking at the GN, its at a different center						-> wrong/incorrect sample center

Possibilities:
	1. snipshot GN is not the GN in merger tree
	2. merger tree has errors in GN or Center
	3. merger tree sample has bugs and not extracting correct center
	
	Likely GN -> go to coords, establish dominant GN in 0.5 radius, reassign that instead.



============================================================
AVAILABLE VARIABLES IN SNIPS:

 Gas 0
['Coordinates', 'Density', 'Entropy', 'GroupNumber', 'SubGroupNumber', 'InternalEnergy', 'Mass', 'Metallicity', 'ParticleIDs', 'Temperature', 'Velocity']
Missing: StarFormationRate
 DM 1
['Coordinates', 'GroupNumber', 'SubGroupNumber', 'ParticleIDs', 'Velocity']
Missing: 
 Stars 4
['Coordinates', 'GroupNumber', 'SubGroupNumber', 'InitialMass', 'Mass', 'Metallicity', 'ParticleIDs', 'SmoothedMetalAbundance_Fe', 'SmoothedMetalAbundance_O', 'SmoothedMetallicity', 'StellarFormationTime', 'Velocity']
Missing: 
 BH 5
['BH_CumlAccrMass', 'BH_CumlNumSeeds', 'BH_Density', 'BH_FormationTime', 'BH_Mass', 'BH_Mdot', 'BH_MostMassiveProgenitorID', 'BH_Pressure', 'BH_SoundSpeed', 'BH_SurroundingGasVel', 'BH_TimeLastMerger', 'Coordinates', 'GroupNumber', 'SubGroupNumber', 'Mass', 'ParticleIDs', 'Velocity']
Missing: 


============================================================




⠀⠀⠀⠀⠀⢀⣀⣀⣀⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣴⠋⠉⠉⠉⠛⢷⣦⡀⠀⠀
⠀⠀⠀⣼⡇⠀⢠⣞⠛⡟⠛⠛⢿⣄⠀
⠀⣴⠶⣿⠀⠀⢸⣏⠂⠤⠤⠔⠒⣿⠀
⢰⡇⠀⣿⠸⠀⠀⠛⠷⠶⠶⠶⢿⣧⠀
⠀⣇⠀⣿⠀⢃⠀⠀⠀⠀⠀⠀⣸⣿⠀
⠰⣿⠀⣿⠀⠀⠢⠀⠀⠀⠠⠊⢸⣿⠀
⠀⢿⣤⣿⡇⠀⠀⣤⣤⣤⠤⠀⢸⡟⠀
⠀⠀⠀⢹⡇⠀⠀⣿⡇⣿⠀⠀⣸⡇⠀
⠀⠀⢴⣾⣿⠿⢿⣻⣽⣽⣛⣛⢻⣷⡆
⠀⠀⠀⠈⠉⠉⠐⠒⠒⠚⠋⠉⠉⠁⠀






============================================================

# Talk to tim about BH-misalignments as next mini thing
# Talk to tim about cancel leiden. 
  Thought about it over the summer and I haven't warmed up to the idea.
  Would rather postpone it to the following year to see how things go then, especially as some of the 
  early work on ColiBre will be done by then.
  Don't feel like I would be comfortable working there for a while on the project and would prefer to 
  stay here.
  The project is OK (if a bit dull for my tastes), but working on such a new simulation right out
  of the box... I'd rather wait a year.
  Prefer the idea of continuing with misalignments in some form, perhaps more directly with AGN or looking
  at origins. 
  Optionally also go on to look at zoom-in simulations as its something i wouldn't mind trying or testing
  as I enjoyed the Tim-Freeke paper.
